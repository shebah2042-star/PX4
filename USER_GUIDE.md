

# دليل المستخدم: نظام التحكم في الصاروخ

---

## 1. مقدمة

هذا الدليل يشرح كيفية إعداد واستخدام **نظام التحكم في الصاروخ**، وهو نظام برمجي متكامل يعمل على حاسوب مرافق (Companion Computer) للتحكم في الصواريخ التي تستخدم متحكم الطيران PX4.

يعتمد النظام على **النهج الهجين**، حيث يتم الجمع بين قوة واستقرار متحكم PX4 ومرونة وقوة الحاسوب المرافق لتنفيذ خوارزميات تحكم وتوجيه متقدمة.

### الجمهور المستهدف

هذا الدليل موجه إلى:
- هواة ومحترفي بناء الصواريخ.
- مطوري أنظمة الطيران بدون طيار.
- الباحثين والطلاب في مجال هندسة الطيران والفضاء.

### المتطلبات الأساسية

قبل البدء، يجب أن يكون لديك فهم أساسي للمفاهيم التالية:
- متحكمات الطيران (خاصة PX4).
- بروتوكول MAVLink.
- لغة البرمجة Python.
- أساسيات أنظمة التحكم (مثل PID).

---

## 2. إعداد النظام

اتبع الخطوات التالية لإعداد النظام على الحاسوب المرافق (مثل Raspberry Pi أو Jetson Nano).

### الخطوة 1: استنساخ المستودع

أولاً، قم بالحصول على جميع ملفات النظام. إذا كان لديك نظام git، يمكنك استنساخ المستودع. إذا لم يكن كذلك، قم بنسخ جميع الملفات والمجلدات إلى الحاسوب المرافق.

### الخطوة 2: تثبيت المتطلبات

يحتوي النظام على بعض الاعتماديات البرمجية التي يجب تثبيتها. افتح الطرفية (Terminal) وانتقل إلى مجلد النظام، ثم قم بتشغيل الأمر التالي:

```bash
cd /path/to/rocket_control_system
pip3 install -r requirements.txt
```

سيقوم هذا الأمر بتثبيت جميع المكتبات اللازمة، بما في ذلك:
- `mavsdk`: للاتصال مع PX4.
- `numpy`: للعمليات الرياضية.
- `pyyaml`: لقراءة ملفات الإعدادات.
- والمزيد...

### الخطوة 3: توصيل الأجهزة

- **الحاسوب المرافق و PX4**: قم بتوصيل الحاسوب المرافق بمنفذ `TELEM2` على متحكم PX4 باستخدام كابل USB-to-Serial أو عبر الاتصال المباشر (UART).
- **السيرفوهات والمحركات**: تأكد من توصيل جميع السيرفوهات (للزعانف) وآليات نشر المظلة بالمنافذ الصحيحة على PX4 كما هو محدد في ملف الإعدادات.

---

## 3. تكوين النظام

يعتمد النظام بشكل كبير على ملفات الإعدادات الموجودة في مجلد `config/`. يجب عليك تعديل هذه الملفات لتتناسب مع تصميم صاروخك وأجهزتك.

### 3.1 إعدادات النظام (`system_config.yaml`)

هذا هو ملف الإعدادات الرئيسي. يحتوي على الأقسام التالية:

- **`mavlink`**: لتكوين الاتصال مع PX4. تأكد من أن `connection_string` يطابق طريقة توصيلك.
  - `udp://:14540`: للاتصال عبر Wi-Fi.
  - `serial:///dev/ttyUSB0:57600`: للاتصال عبر USB.

- **`servos`**: لتعريف السيرفوهات. لكل سيرفو، يجب تحديد:
  - `channel`: رقم المنفذ على PX4 (يبدأ من 0).
  - `min_pwm`, `max_pwm`, `center_pwm`: قيم PWM التي تحدد نطاق حركة السيرفو.

- **`parachute`**: لتكوين آلية نشر المظلة.
  - `drogue_channel`, `main_channel`: أرقام المنافذ.
  - `drogue_altitude`, `main_altitude`: الارتفاعات التي سيتم فيها نشر المظلات تلقائياً.

- **`safety_limits`**: لتحديد حدود الطيران الآمنة (أقصى ارتفاع، سرعة، زاوية، إلخ).

- **`apogee_detection`**: لضبط حساسية خوارزمية كشف القمة.

### 3.2 إعدادات PID (`pid_config.yaml`)

هذا الملف يحتوي على معاملات (gains) متحكمات PID. هذه القيم حاسمة لأداء واستقرار الصاروخ.

- **`pitch`, `yaw`, `roll`**: معاملات متحكمات الزوايا.
- **`altitude`, `vertical_velocity`**: معاملات متحكمات الارتفاع والسرعة العمودية.

> **ملاحظة هامة**: ضبط معاملات PID هي عملية معقدة وتتطلب خبرة. ابدأ بقيم منخفضة وقم بزيادتها تدريجياً. قد يؤدي استخدام قيم غير صحيحة إلى عدم استقرار الصاروخ.

### 3.3 إعدادات الأمان (`safety_config.yaml`)

هذا الملف يحدد سلوك نظام الأمان (Fail-safe).

- **`failsafe`**: لتفعيل أو تعطيل نظام الأمان وتحديد مهلة فقدان الاتصال.
- **`operational_limits`**: لتحديد حدود التشغيل الآمنة (مثل أقصى سرعة رياح).
- **`flight_termination`**: لتكوين نظام إنهاء الطيران في حالات الطوارئ القصوى.

---

## 4. تشغيل النظام

بعد إعداد وتكوين النظام، يمكنك تشغيله.

### الخطوة 1: تشغيل PX4

قم بتشغيل متحكم PX4 وتأكد من أنه في وضع الاستعداد.

### الخطوة 2: تشغيل البرنامج الرئيسي

على الحاسوب المرافق، افتح الطرفية وانتقل إلى مجلد النظام، ثم قم بتشغيل الأمر التالي:

```bash
python3 main.py
```

### ماذا يحدث عند التشغيل؟

1.  **التهيئة**: سيحاول البرنامج الاتصال بـ PX4، وتهيئة جميع الوحدات، وبدء استقبال البيانات.
2.  **مرحلة ما قبل الإطلاق**: سيدخل النظام في وضع `PRE_LAUNCH`. في هذه المرحلة، سيقوم بفحص الأنظمة والانتظار لكشف الإطلاق.
3.  **الإطلاق والصعود**: بمجرد كشف تسارع الإطلاق، ستنتقل آلة الحالة إلى `LAUNCH` ثم `ASCENT`. سيبدأ نظام التحكم في تثبيت الصاروخ.
4.  **القمة والهبوط**: عند الوصول إلى القمة، سيتم كشفها تلقائياً (`APOGEE`) وسيتم نشر المظلة الأولية. ثم تبدأ مرحلة الهبوط (`DESCENT`).
5.  **الاسترجاع**: سيتم نشر المظلة الرئيسية عند الارتفاع المحدد، وبعد الهبوط، سيدخل النظام في وضع `RECOVERY`.

### إيقاف النظام

لإيقاف النظام بشكل آمن، اضغط على `Ctrl+C` في الطرفية. سيقوم البرنامج بتنفيذ إجراءات الإيقاف، بما في ذلك حفظ جميع البيانات وقطع الاتصال.

---

## 5. تحليل البيانات

يقوم النظام بتسجيل كمية كبيرة من البيانات أثناء الطيران، والتي يمكن استخدامها لتحليل الأداء وتحديد المشاكل.

### موقع البيانات

- **السجلات (Logs)**: يتم حفظ سجلات تشغيل النظام في مجلد `logs/`.
- **بيانات الطيران (Data)**: يتم حفظ جميع بيانات الطيران في مجلد `data/`.

### ملفات البيانات

لكل رحلة، يتم إنشاء مجموعة من الملفات باسم الجلسة (تاريخ ووقت التشغيل):

- **`{session}_sensors.csv`**: يحتوي على جميع قراءات المستشعرات الخام (زوايا، ارتفاع، سرعة، تسارع، إلخ) مع طابع زمني.
- **`{session}_control.csv`**: يحتوي على بيانات التحكم (المرحلة الحالية، أوامر التحكم، حالة المظلات، إلخ).
- **`{session}_events.json`**: يسجل الأحداث الهامة التي وقعت أثناء الطيران (الإطلاق، كشف القمة، نشر المظلة، إلخ).
- **`{session}_summary.json`**: ملف ملخص يحتوي على أهم معلومات الرحلة (أقصى ارتفاع، مدة الطيران، إلخ).

### كيفية استخدام البيانات

يمكنك استخدام برامج مثل Microsoft Excel, Google Sheets, أو مكتبات Python مثل `pandas` و `matplotlib` لفتح هذه الملفات وتحليلها ورسمها بيانياً.

---

## 6. استكشاف الأخطاء وإصلاحها

- **فشل الاتصال بـ PX4**: تأكد من صحة `connection_string` في `system_config.yaml`، وأن الكابل موصل بشكل صحيح، وأن PX4 يعمل.
- **السيرفوهات لا تتحرك**: تحقق من توصيل السيرفوهات بالمنافذ الصحيحة، وأن قيم PWM في `system_config.yaml` صحيحة.
- **النظام غير مستقر**: هذه مشكلة معقدة تتعلق بضبط PID. حاول تقليل قيم `kp`, `ki`, `kd` في `pid_config.yaml`.
- **لم يتم كشف القمة**: تحقق من إعدادات `apogee_detection` في `system_config.yaml`. قد تحتاج إلى ضبط العتبات.

---

**إخلاء مسؤولية**: هذا النظام هو أداة قوية ولكنها معقدة. أنت المسؤول الوحيد عن سلامة عملياتك. قم دائمًا بإجراء اختبارات أرضية شاملة قبل أي رحلة فعلية. اتبع جميع قوانين ولوائح الطيران المحلية.

